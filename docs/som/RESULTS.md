# Guide to Understanding the Output Structure

This document describes the structure and content of the output directory generated by a single run of the SOM algorithm. All results, logs, and visualizations are organized into a self-contained directory to ensure clarity and reproducibility.

## Root Directory Structure

A typical output directory (e.g., `results/20240918_103000/`) contains the following key subdirectories and files:

*   **`csv/`**: Contains data files in CSV and NumPy formats, representing various stages of the data pipeline.
*   **`json/`**: Contains structured data files in JSON format, including analysis results and metadata.
*   **`visualizations/`**: Contains all generated plots and maps.
*   **`log.txt`**: A detailed, timestamped log file of the entire process, from data loading to final analysis.

---

## 1. `csv/` Directory - Data Files

This directory holds the core data artifacts of the process.

*   `original_input.csv`: A direct copy of the input file used for the run.
*   `training_data.npy`: The final, fully preprocessed data used to train the SOM. This is a binary NumPy array file containing normalized, numerical data. **This file does not contain headers.**
*   `training_data_readable.csv`: A human-readable version of `training_data.npy`. It contains the exact same data, making it useful for manual inspection. **This file does not contain headers.**
*   `ignore_mask.csv`: A boolean matrix with the same dimensions as the training data. A value of `True` indicates that the corresponding data point at that position was ignored during training (either because it was originally a missing value or it belongs to an ignored column like `primary_id`). **This file does not contain headers.**
*   `weights.npy`: A binary NumPy array file containing the final weight vectors of all neurons in the trained SOM.
*   `weights_readable.csv`: A human-readable version of the final weights, where each row represents a neuron, its coordinates, and its weight vector.

---

## 2. `json/` Directory - Structured Results and Metadata

This directory contains detailed results and information in a machine-readable format.

*   `preprocessing_info.json`: Contains detailed metadata about each column from the original dataset, including its detected type (numeric/text), whether it was treated as categorical, and if it was ignored as "noise".
*   `clusters.json`: Maps each active neuron (e.g., `"i_j"`) to a list of `primary_id` values of the data samples that belong to it. This file is essential for linking SOM results back to the original data.
*   `quantization_errors.json`: Provides the overall Mean Quantization Error (MQE) for the map, as well as the specific MQE for each individual neuron.
*   `extremes.json`: Contains the results of the outlier detection analysis, listing the `primary_id` of extreme data points and the reason why they were flagged.
*   `pie_data_*.json`: (Optional) Data files used as input for generating Pie Maps for categorical features. Each file contains the distribution of categories for each neuron.

---

#### Detailed Look: `preprocessing_info.json`

This file provides a comprehensive summary of the automated analysis performed on each column of the input dataset. It is key to understanding why certain columns were processed in a specific way or ignored.

**Example Entry:**

```json
  "SepalLengthCm": {
    "status": "used",
    "reason": "",
    "type": "float64",
    "nunique": 35,
    "nunique_ratio": 0.23333333333333334,
    "base_type": "numeric",
    "is_categorical": false
  },
  "Species": {
    "status": "used",
    "reason": "",
    "type": "object",
    "nunique": 3,
    "nunique_ratio": 0.02,
    "base_type": "text",
    "is_categorical": true
  },
  "some_text_column": {
    "status": "ignored",
    "reason": "High cardinality / noise",
    "type": "object",
    "nunique": 145,
    "nunique_ratio": 0.9666666666666667,
    "base_type": "text",
    "is_noise": true
  }
```

**Key Description:**

*   `"status"`: Indicates the final action taken for the column.
    *   `"used"`: The column was included in the training data.
    *   `"ignored"`: The column was excluded from the training data.
*   `"reason"`: Explains why a column was ignored (e.g., it is a `Primary ID` or considered `High cardinality / noise`).
*   `"type"`: The original data type as detected by Pandas (e.g., `float64`, `int64`, `object`).
*   `"nunique"`: The number of unique values in the column.
*   `"nunique_ratio"`: The ratio of unique values to the total number of rows.
*   `"base_type"`: The simplified data type assigned by the preprocessor (`"numeric"` or `"text"`).
*   `"is_categorical"`: (Boolean) `true` if the column was treated as categorical based on the number of unique values (defined by `categorical_threshold_*` in the config).
*   `"is_noise"`: (Boolean) `true` if a text column was flagged as noise due to a high unique value ratio (defined by `noise_threshold_ratio` in the config).

---

---

## 3. `visualizations/` Directory - Plots and Maps

This directory contains all graphical outputs for visual analysis.

### Training Process Graphs

These plots illustrate the behavior of the algorithm during the training process. They are crucial for diagnosing convergence and understanding how hyperparameters evolved.

*   `mqe_evolution.png`: Shows the evolution of the Mean Quantization Error (MQE) over the training iterations.
*   `learning_rate_decay.png`: Visualizes the decay of the learning rate.
*   `radius_decay.png`: Visualizes the decay of the neighborhood radius.
*   `batch_size_growth.png`: (For hybrid mode) Shows how the number of processed samples increased over time.

### SOM Analysis Maps

These maps are visualizations of the trained SOM grid and are the primary tools for interpreting the data's structure.

*   **Component Planes (`component_*.png`):** A set of maps, one for each data dimension (feature). Each map shows the distribution of weights for that feature across the SOM grid, revealing patterns and correlations.
*   **`u_matrix.png` (Unified Distance Matrix):** Visualizes the distances between adjacent neurons. High-value areas ("mountains") represent boundaries between clusters, while low-value areas ("valleys") represent coherent clusters.
*   **`hit_map.png`:** Shows how many data samples are mapped to each neuron. It is useful for identifying the density of data across the map.
*   **`cluster_map.png`:** A simple map where each active neuron (a neuron that won at least one data sample) is colored uniquely.
*   **`distance_map.png`:** Visualizes the average quantization error for each neuron. "Hot" areas indicate neurons that represent a diverse set of data points poorly.
*   **Pie Maps (`pie-map_*.png`):** (Optional) For categorical features, this map shows a pie chart on each neuron, representing the distribution of categories within that neuron's cluster.

### `legends/` Subdirectory

This folder contains standalone legend images for each of the generated SOM analysis maps, allowing for clear and uncluttered presentation.